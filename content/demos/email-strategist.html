<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gestione Commesse e Pratiche Edilizie &mdash; Praxis AI</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Caveat:wght@700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --navy:#0f172a;--navy-light:#1e3a5f;--navy-muted:#334155;
  --silver:#94a3b8;--surface:#f0f4f8;--surface-light:#f8fafc;
  --surface-dark:#e2e8f0;--ice:#fafbfd;--border:#cbd5e1;
  --white:#ffffff;--accent-green:#16a34a;--accent-amber:#d97706;--accent-red:#dc2626;
  --font-body:'Inter',system-ui,sans-serif;--font-display:'Caveat',cursive;
  --shadow-sm:0 1px 3px rgba(15,23,42,0.06);--shadow-md:0 4px 12px rgba(15,23,42,0.1);
  --shadow-lg:0 8px 30px rgba(15,23,42,0.14);
  --radius-sm:8px;--radius-md:12px;--radius-lg:16px;
}
html{font-size:16px}
body{font-family:var(--font-body);background:var(--surface);color:var(--navy);min-height:100vh;-webkit-font-smoothing:antialiased;padding-bottom:20px}

/* Header */
.header{display:flex;align-items:center;justify-content:space-between;padding:16px 28px;border-bottom:1px solid var(--border);background:var(--navy);color:var(--white);position:sticky;top:0;z-index:100}
.header-left{display:flex;align-items:center;gap:16px}
.header-brand{font-family:var(--font-display);font-size:24px;font-weight:700;color:var(--white)}
.header-title{font-size:13px;color:var(--silver);font-weight:500}
.header-badge{display:inline-block;background:var(--accent-amber);color:var(--white);font-size:10px;font-weight:700;padding:3px 10px;border-radius:20px;letter-spacing:1px;text-transform:uppercase}

/* Progress */
.progress-bar{display:flex;align-items:center;gap:12px;padding:14px 28px;background:var(--white);border-bottom:1px solid var(--border)}
.progress-steps{display:flex;gap:6px;flex:1}
.progress-step{flex:1;height:4px;border-radius:2px;background:var(--surface-dark);transition:background .4s}
.progress-step.active{background:var(--navy)}
.progress-step.done{background:var(--accent-green)}
.progress-label{font-size:12px;font-weight:600;color:var(--navy-muted);white-space:nowrap}
.btn-next{padding:8px 24px;background:var(--navy);color:var(--white);border:none;border-radius:var(--radius-sm);font-size:13px;font-weight:600;font-family:var(--font-body);cursor:pointer;transition:background .2s,transform .15s}
.btn-next:hover{background:var(--navy-light)}
.btn-next:active{transform:scale(.97)}
.btn-next:disabled{opacity:.4;cursor:not-allowed}

/* Main */
.main{max-width:1100px;margin:0 auto;padding:24px 24px 0}
.step-container{display:none;opacity:0;transform:translateY(16px);transition:opacity .5s,transform .5s}
.step-container.active{display:block;opacity:1;transform:translateY(0)}
.step-label{font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--silver);margin-bottom:14px;display:flex;align-items:center;gap:8px}
.step-num{width:22px;height:22px;border-radius:50%;background:var(--navy);color:var(--white);font-size:11px;font-weight:700;display:flex;align-items:center;justify-content:center}

/* Kanban */
.kanban{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:16px}
.kanban-col{background:var(--surface-light);border-radius:var(--radius-md);border:1px solid var(--border);overflow:hidden}
.kanban-col-header{padding:10px 14px;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:6px}
.kanban-col-header .dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.phase-design .dot{background:#6366f1}.phase-scia .dot{background:var(--accent-amber)}.phase-cantiere .dot{background:var(--accent-green)}.phase-collaudo .dot{background:#8b5cf6}
.kanban-card{margin:10px;padding:14px;background:var(--white);border-radius:var(--radius-sm);border:1px solid var(--border);box-shadow:var(--shadow-sm);transition:box-shadow .2s,transform .2s;cursor:default}
.kanban-card:hover{box-shadow:var(--shadow-md);transform:translateY(-1px)}
.kanban-card-title{font-size:13px;font-weight:700;color:var(--navy);margin-bottom:4px}
.kanban-card-desc{font-size:11px;color:var(--navy-muted);line-height:1.5;margin-bottom:6px}
.kanban-card-client{font-size:10px;color:var(--silver);font-weight:500}
.kanban-badge{display:inline-flex;align-items:center;gap:4px;font-size:10px;font-weight:600;padding:3px 8px;border-radius:12px;margin-top:8px}
.badge-amber{background:rgba(217,119,6,0.12);color:var(--accent-amber)}
.badge-green{background:rgba(22,163,74,0.12);color:var(--accent-green)}
.badge-purple{background:rgba(139,92,246,0.12);color:#7c3aed}
.kanban-progress{margin-top:8px}
.kanban-progress-track{height:4px;background:var(--surface-dark);border-radius:2px;overflow:hidden}
.kanban-progress-fill{height:100%;background:var(--accent-green);border-radius:2px;transition:width 1.2s cubic-bezier(.22,1,.36,1)}
.kanban-progress-label{font-size:10px;font-weight:600;color:var(--accent-green);margin-top:3px}
.stats-bar{display:flex;align-items:center;justify-content:center;gap:6px;font-size:13px;font-weight:600;color:var(--navy);padding:10px;background:var(--white);border-radius:var(--radius-sm);border:1px solid var(--border)}

/* Document Analysis */
.doc-expand{background:var(--white);border-radius:var(--radius-lg);border:1px solid var(--border);box-shadow:var(--shadow-sm);padding:24px;margin-bottom:16px;position:relative;overflow:hidden}
.doc-header{display:flex;align-items:center;gap:12px;margin-bottom:16px}
.doc-icon{font-size:28px}
.doc-title{font-size:16px;font-weight:700;color:var(--navy)}
.doc-subtitle{font-size:12px;color:var(--silver);margin-top:2px}
.scanner-line{position:absolute;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--navy),transparent);opacity:0;animation:none}
.scanner-line.active{opacity:1;animation:scanDown 2s ease-in-out infinite}
@keyframes scanDown{0%{top:0}100%{top:100%}}
.param-list{display:flex;flex-direction:column;gap:8px}
.param-row{display:flex;align-items:center;gap:12px;padding:10px 14px;background:var(--surface-light);border-radius:var(--radius-sm);border:1px solid var(--border);opacity:0;transform:translateX(-12px);transition:opacity .4s,transform .4s,background .3s,border-color .3s}
.param-row.visible{opacity:1;transform:translateX(0)}
.param-row.amber{background:rgba(217,119,6,0.08);border-color:var(--accent-amber)}
.param-row.amber .param-status{color:var(--accent-amber)}
.param-label{font-size:12px;font-weight:600;color:var(--navy);min-width:160px;flex-shrink:0}
.param-value{font-size:12px;color:var(--navy-muted);flex:1}
.param-status{font-size:14px;flex-shrink:0;font-weight:700}
.param-status.ok{color:var(--accent-green)}
.param-row.clickable{cursor:pointer;position:relative}
.param-row.clickable.amber{animation:pulseAmber 2s ease-in-out infinite}
@keyframes pulseAmber{0%,100%{box-shadow:0 0 0 0 rgba(217,119,6,0.3)}50%{box-shadow:0 0 0 6px rgba(217,119,6,0)}}
.param-detail{display:none;margin-top:12px;padding:16px;background:var(--white);border-radius:var(--radius-sm);border:1px solid var(--accent-amber);animation:detailSlide .4s ease}
.param-detail.visible{display:block}
@keyframes detailSlide{from{opacity:0;max-height:0}to{opacity:1;max-height:500px}}
.param-detail-title{font-size:14px;font-weight:700;color:var(--accent-amber);margin-bottom:10px;display:flex;align-items:center;gap:6px}
.param-detail p{font-size:12px;color:var(--navy-muted);line-height:1.6;margin-bottom:6px}
.param-detail .suggestion{padding:8px 12px;background:var(--surface-light);border-radius:var(--radius-sm);border-left:3px solid var(--navy);margin-bottom:6px;font-size:12px;color:var(--navy);line-height:1.5}
.doc-stats{margin-top:14px;font-size:13px;font-weight:600;color:var(--navy);display:flex;align-items:center;gap:8px;opacity:0;transition:opacity .5s}
.doc-stats.visible{opacity:1}

/* Timeline */
.timeline{background:var(--white);border-radius:var(--radius-lg);border:1px solid var(--border);box-shadow:var(--shadow-sm);padding:24px;margin-bottom:16px}
.timeline-title{font-size:16px;font-weight:700;color:var(--navy);margin-bottom:20px}
.timeline-items{display:flex;flex-direction:column;gap:0}
.timeline-item{display:flex;gap:16px;position:relative}
.timeline-dot-wrap{display:flex;flex-direction:column;align-items:center;flex-shrink:0;width:24px}
.timeline-dot{width:20px;height:20px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:10px;flex-shrink:0;border:2px solid var(--border);background:var(--white);transition:all .4s}
.timeline-dot.done{background:var(--accent-green);border-color:var(--accent-green);color:var(--white)}
.timeline-dot.current{background:var(--accent-amber);border-color:var(--accent-amber);color:var(--white);animation:dotPulse 2s ease-in-out infinite}
.timeline-dot.pending{background:var(--surface-dark);border-color:var(--border);color:var(--silver)}
@keyframes dotPulse{0%,100%{box-shadow:0 0 0 0 rgba(217,119,6,0.4)}50%{box-shadow:0 0 0 8px rgba(217,119,6,0)}}
.timeline-line{width:2px;flex:1;background:var(--border);min-height:16px;margin:4px 0}
.timeline-line.done{background:var(--accent-green)}
.timeline-content{padding-bottom:20px;flex:1}
.timeline-content-label{font-size:13px;font-weight:700;color:var(--navy);margin-bottom:2px}
.timeline-content-date{font-size:11px;color:var(--silver);font-weight:500}
.timeline-item:last-child .timeline-content{padding-bottom:0}
.timeline-item.visible{opacity:1;transform:translateX(0)}

.alert-box{display:flex;align-items:flex-start;gap:10px;padding:14px 16px;background:rgba(217,119,6,0.08);border:1px solid var(--accent-amber);border-radius:var(--radius-sm);margin-top:16px;opacity:0;transition:opacity .5s}
.alert-box.visible{opacity:1}
.alert-icon{font-size:18px;flex-shrink:0;margin-top:1px}
.alert-text{font-size:12px;color:var(--navy);line-height:1.6}
.alert-text strong{font-weight:700}
.countdown-box{display:flex;align-items:center;justify-content:center;gap:8px;margin-top:12px;padding:10px;background:var(--white);border-radius:var(--radius-sm);border:1px solid var(--accent-amber);font-size:15px;font-weight:700;color:var(--accent-amber);opacity:0;transition:opacity .5s}
.countdown-box.visible{opacity:1}

/* Gantt */
.gantt{background:var(--white);border-radius:var(--radius-lg);border:1px solid var(--border);box-shadow:var(--shadow-sm);padding:24px;margin-bottom:16px}
.gantt-title{font-size:16px;font-weight:700;color:var(--navy);margin-bottom:18px}
.gantt-row{display:flex;align-items:center;gap:14px;padding:12px 0;border-bottom:1px solid var(--surface-dark)}
.gantt-row:last-child{border-bottom:none}
.gantt-label{width:180px;flex-shrink:0}
.gantt-label-name{font-size:13px;font-weight:700;color:var(--navy)}
.gantt-label-date{font-size:10px;color:var(--silver);margin-top:2px}
.gantt-bar-track{flex:1;height:24px;background:var(--surface);border-radius:4px;overflow:hidden;position:relative}
.gantt-bar-fill{height:100%;border-radius:4px;transition:width 1.5s cubic-bezier(.22,1,.36,1);position:relative}
.gantt-bar-fill.c1{background:linear-gradient(90deg,#6366f1,#818cf8)}
.gantt-bar-fill.c2{background:linear-gradient(90deg,var(--accent-amber),#fbbf24)}
.gantt-bar-fill.c3{background:linear-gradient(90deg,var(--accent-green),#4ade80)}
.gantt-bar-fill.c4{background:linear-gradient(90deg,#8b5cf6,#a78bfa)}
.gantt-pct{width:40px;font-size:13px;font-weight:700;color:var(--navy);text-align:right;flex-shrink:0}
.gantt-milestone{position:absolute;top:-2px;width:8px;height:8px;background:var(--navy);border-radius:50%;border:2px solid var(--white);z-index:2}

.ai-suggestion{display:flex;align-items:flex-start;gap:12px;padding:16px;background:linear-gradient(135deg,rgba(15,23,42,0.04),rgba(30,58,95,0.06));border:1px solid var(--navy-light);border-radius:var(--radius-md);margin-top:16px;opacity:0;transition:opacity .5s}
.ai-suggestion.visible{opacity:1}
.ai-icon{font-size:22px;flex-shrink:0}
.ai-text{font-size:12px;color:var(--navy);line-height:1.6}
.ai-text strong{font-weight:700}

.resource-bar{display:flex;gap:16px;margin-top:12px;opacity:0;transition:opacity .5s}
.resource-bar.visible{opacity:1}
.resource-item{flex:1;padding:12px;background:var(--surface-light);border-radius:var(--radius-sm);border:1px solid var(--border);text-align:center}
.resource-item-label{font-size:11px;color:var(--silver);font-weight:500;margin-bottom:4px}
.resource-item-value{font-size:14px;font-weight:700;color:var(--navy)}

.cta-final{text-align:center;margin-top:20px;padding:20px;background:var(--navy);border-radius:var(--radius-md);opacity:0;transition:opacity .5s}
.cta-final.visible{opacity:1}
.cta-final-text{font-size:16px;font-weight:700;color:var(--white);margin-bottom:12px}
.cta-final-btn{padding:12px 32px;background:var(--accent-amber);color:var(--white);border:none;border-radius:var(--radius-sm);font-size:14px;font-weight:700;font-family:var(--font-body);cursor:pointer;transition:background .2s,transform .15s}
.cta-final-btn:hover{background:#b45309;transform:translateY(-1px)}

@media(max-width:900px){
  .kanban{grid-template-columns:repeat(2,1fr)}
  .header{padding:12px 16px;flex-wrap:wrap;gap:8px}
  .main{padding:16px 12px 0}
  .progress-bar{padding:10px 16px}
  .gantt-label{width:120px}
}
@media(max-width:600px){
  .kanban{grid-template-columns:1fr}
  .param-label{min-width:120px}
  .gantt-row{flex-wrap:wrap;gap:6px}
  .gantt-label{width:100%}
  .resource-bar{flex-direction:column}
}
</style>
</head>
<body>

<header class="header">
  <div class="header-left">
    <span class="header-brand">Praxis AI</span>
    <span class="header-title" data-i18n="headerTitle">Gestione Commesse e Pratiche Edilizie</span>
  </div>
  <span class="header-badge">DEMO</span>
</header>

<div class="progress-bar">
  <div class="progress-steps">
    <div class="progress-step" id="pstep1"></div>
    <div class="progress-step" id="pstep2"></div>
    <div class="progress-step" id="pstep3"></div>
    <div class="progress-step" id="pstep4"></div>
  </div>
  <span class="progress-label" id="progressLabel">Step 1 / 4</span>
  <button class="btn-next" id="btnNext" data-i18n="btnNext">Avanti</button>
</div>

<div class="main">

  <!-- Step 1: Project Dashboard -->
  <div class="step-container" id="step1">
    <div class="step-label"><span class="step-num">1</span> <span data-i18n="step1Label">Project Dashboard</span></div>
    <div class="kanban" id="kanban"></div>
    <div class="stats-bar" id="statsBar" data-i18n="statsBar">4 commesse attive &mdash; &euro;2.4M valore complessivo</div>
  </div>

  <!-- Step 2: Document Analysis -->
  <div class="step-container" id="step2">
    <div class="step-label"><span class="step-num">2</span> <span data-i18n="step2Label">Document Analysis</span></div>
    <div class="doc-expand" id="docExpand">
      <div class="scanner-line" id="scannerLine"></div>
      <div class="doc-header">
        <span class="doc-icon">&#128196;</span>
        <div>
          <div class="doc-title" data-i18n="docTitle">Residenza Via Verdi &mdash; Relazione Tecnica</div>
          <div class="doc-subtitle" data-i18n="docSubtitle">AI Document Scanner</div>
        </div>
      </div>
      <div class="param-list" id="paramList"></div>
      <div id="paramDetailContainer"></div>
      <div class="doc-stats" id="docStats" data-i18n="docStats">7 parametri verificati &mdash; 1 non conforme</div>
    </div>
  </div>

  <!-- Step 3: Permit Tracking -->
  <div class="step-container" id="step3">
    <div class="step-label"><span class="step-num">3</span> <span data-i18n="step3Label">Permit Tracking</span></div>
    <div class="timeline" id="timelinePanel">
      <div class="timeline-title" data-i18n="timelineTitle">Ristrutturazione Palazzo Manzoni &mdash; Iter Autorizzativo</div>
      <div class="timeline-items" id="timelineItems"></div>
      <div class="alert-box" id="alertBox">
        <span class="alert-icon">&#9888;&#65039;</span>
        <div class="alert-text" id="alertText"></div>
      </div>
      <div class="countdown-box" id="countdownBox"></div>
    </div>
  </div>

  <!-- Step 4: Multi-Project Timeline -->
  <div class="step-container" id="step4">
    <div class="step-label"><span class="step-num">4</span> <span data-i18n="step4Label">Multi-Project Timeline</span></div>
    <div class="gantt" id="ganttPanel">
      <div class="gantt-title" data-i18n="ganttTitle">Timeline Commesse</div>
      <div id="ganttRows"></div>
    </div>
    <div class="ai-suggestion" id="aiSuggestion">
      <span class="ai-icon">&#129302;</span>
      <div class="ai-text" id="aiText"></div>
    </div>
    <div class="resource-bar" id="resourceBar">
      <div class="resource-item">
        <div class="resource-item-label" data-i18n="resArchitects">Architetti</div>
        <div class="resource-item-value">3/4</div>
      </div>
      <div class="resource-item">
        <div class="resource-item-label" data-i18n="resEngineers">Ingegneri strutturisti</div>
        <div class="resource-item-value">2/2</div>
      </div>
    </div>
    <div class="cta-final" id="ctaFinal">
      <div class="cta-final-text" id="ctaText" data-i18n="ctaText">Vuoi gestire le tue commesse con l'AI?</div>
      <button class="cta-final-btn" data-i18n="ctaBtn">Scopri Praxis AI</button>
    </div>
  </div>

</div>

<script>
(function(){
'use strict';

var LOCALE = (typeof window !== 'undefined' && window.__PRAXIS_LOCALE__) || 'it';

var T_ALL = {
en: {
  headerTitle:'Project & Permit Management',
  btnNext:'Next',
  step1Label:'Project Dashboard',
  step2Label:'Document Analysis',
  step3Label:'Permit Tracking',
  step4Label:'Multi-Project Timeline',
  statsBar:'4 active projects \u2014 \u20AC2.4M total value',
  docTitle:'Residenza Via Verdi \u2014 Technical Report',
  docSubtitle:'AI Document Scanner',
  docStats:'7 parameters verified \u2014 1 non-compliant',
  timelineTitle:'Ristrutturazione Palazzo Manzoni \u2014 Permit Process',
  ganttTitle:'Project Timeline',
  resArchitects:'Architects',
  resEngineers:'Structural Engineers',
  ctaText:'Want to manage your projects with AI?',
  ctaBtn:'Discover Praxis AI',
  stepOf:'Step',
  of:'of',
  col1:'Design',col2:'SCIA Submitted',col3:'Construction',col4:'Final Inspection',
  card1Title:'Residenza Via Verdi',
  card1Desc:'New residential building, 12 units',
  card1Client:'Client: Immobiliare Lombardia S.r.l.',
  card2Title:'Ristrutturazione Palazzo Manzoni',
  card2Desc:'Historic facade restoration',
  card2Client:'Client: Condominio Palazzo Manzoni',
  card2Badge:'Awaiting response (day 24/30)',
  card3Title:'Capannone Industriale ZAI',
  card3Desc:'New construction 2,500 sqm',
  card3Client:'Client: Logistics Hub S.p.A.',
  card4Title:'Uffici Piazza Duomo',
  card4Desc:'Change of use',
  card4Client:'Client: Studio Associato Pellegrini',
  card4Badge:'Inspection scheduled: 28/02/2026',
  p1Label:'Urban zone',p1Value:'B1 \u2014 Residential infill',
  p2Label:'Building index',p2Value:'1.2 mc/sqm \u2014 PRG compliant',
  p3Label:'Maximum height',p3Value:'12.5m \u2014 Compliant (max 14m)',
  p4Label:'Setback from boundaries',p4Value:'5.0m \u2014 Compliant (min 5m)',
  p5Label:'Coverage ratio',p5Value:'42% \u2014 WARNING (max 40%)',
  p6Label:'Landscape restrictions',p6Value:'No restrictions applicable',
  p7Label:'Target energy class',p7Value:'A2',
  detailTitle:'Coverage Ratio Non-Compliant',
  detailCalc:'Calculated: 42% (Built area: 504 sqm / Land area: 1,200 sqm)',
  detailLimit:'PRG zone B1 limit: 40% (max 480 sqm)',
  detailExcess:'Excess: 24 sqm',
  detailSugTitle:'Suggestions:',
  detailSug1:'1. Reduce built area by 24 sqm (e.g. set back north facade by 1.2m)',
  detailSug2:'2. Request PRG variance for coverage ratio increase',
  detailSug3:'3. Check eligibility for derogation under Art. 14 D.P.R. 380/2001 for sustainable construction',
  clickHint:'Click to expand analysis',
  tl1:'Preliminary Design',tl1Date:'15/11/2025',
  tl2:'SCIA Submitted',tl2Date:'10/01/2026',
  tl3:'Integration Request',tl3Date:'25/01/2026',
  tl4:'Supplementary Documents',tl4Date:'Deadline: 25/02/2026',
  tl5:'Tacit Approval',tl5Date:'Expected: 10/03/2026',
  alertText:'Integration deadline in 7 days \u2014 Missing documents: Structural report, Cultural Heritage clearance',
  countdownText:'7 days remaining',
  g1Name:'Residenza Via Verdi',g1Date:'Jan\u2013Dec 2026',
  g2Name:'Palazzo Manzoni',g2Date:'Sep 2025\u2013Apr 2026',
  g3Name:'Capannone ZAI',g3Date:'May 2025\u2013Jul 2026',
  g4Name:'Uffici Piazza Duomo',g4Date:'Jan 2025\u2013Feb 2026',
  aiSuggestion:'Resource optimization: reassign the surveyor from Uffici project (final phase) to Residenza project to accelerate the design phase',
  progressLabel:'Step {n} of 4'
},
it: {
  headerTitle:'Gestione Commesse e Pratiche Edilizie',
  btnNext:'Avanti',
  step1Label:'Dashboard Commesse',
  step2Label:'Analisi Documentale',
  step3Label:'Tracciamento Pratiche',
  step4Label:'Timeline Multi-Progetto',
  statsBar:'4 commesse attive \u2014 \u20AC2.4M valore complessivo',
  docTitle:'Residenza Via Verdi \u2014 Relazione Tecnica',
  docSubtitle:'AI Document Scanner',
  docStats:'7 parametri verificati \u2014 1 non conforme',
  timelineTitle:'Ristrutturazione Palazzo Manzoni \u2014 Iter Autorizzativo',
  ganttTitle:'Timeline Commesse',
  resArchitects:'Architetti',
  resEngineers:'Ingegneri strutturisti',
  ctaText:'Vuoi gestire le tue commesse con l\'AI?',
  ctaBtn:'Scopri Praxis AI',
  stepOf:'Step',
  of:'di',
  col1:'Progettazione',col2:'SCIA Presentata',col3:'Cantiere in Corso',col4:'Collaudo',
  card1Title:'Residenza Via Verdi',
  card1Desc:'Nuovo edificio residenziale 12 unit\u00E0',
  card1Client:'Committente: Immobiliare Lombardia S.r.l.',
  card2Title:'Ristrutturazione Palazzo Manzoni',
  card2Desc:'Recupero facciata storica',
  card2Client:'Committente: Condominio Palazzo Manzoni',
  card2Badge:'In attesa risposta (gg. 24/30)',
  card3Title:'Capannone Industriale ZAI',
  card3Desc:'Nuova costruzione 2.500 mq',
  card3Client:'Committente: Logistics Hub S.p.A.',
  card4Title:'Uffici Piazza Duomo',
  card4Desc:'Cambio destinazione d\'uso',
  card4Client:'Committente: Studio Associato Pellegrini',
  card4Badge:'Collaudo previsto: 28/02/2026',
  p1Label:'Zona urbanistica',p1Value:'B1 \u2014 Residenziale di completamento',
  p2Label:'Indice di fabbricabilit\u00E0',p2Value:'1.2 mc/mq \u2014 Conforme al PRG',
  p3Label:'Altezza massima',p3Value:'12.5m \u2014 Conforme (max 14m)',
  p4Label:'Distanza dai confini',p4Value:'5.0m \u2014 Conforme (min 5m)',
  p5Label:'Rapporto di copertura',p5Value:'42% \u2014 \u26A0 ATTENZIONE (max 40%)',
  p6Label:'Vincoli paesaggistici',p6Value:'Nessun vincolo applicabile',
  p7Label:'Classe energetica target',p7Value:'A2',
  detailTitle:'\u26A0 Rapporto di Copertura Non Conforme',
  detailCalc:'Calcolato: 42% (Superficie coperta: 504 mq / Superficie fondiaria: 1.200 mq)',
  detailLimit:'Limite PRG zona B1: 40% (max 480 mq)',
  detailExcess:'Eccedenza: 24 mq',
  detailSugTitle:'Suggerimenti:',
  detailSug1:'1. Ridurre la superficie coperta di 24 mq (es. arretrare la facciata nord di 1.2m)',
  detailSug2:'2. Richiedere variante al PRG per incremento rapporto copertura',
  detailSug3:'3. Verificare possibilit\u00E0 di deroga ex Art. 14 D.P.R. 380/2001 per edilizia sostenibile',
  clickHint:'Clicca per espandere l\'analisi',
  tl1:'Progetto Preliminare',tl1Date:'15/11/2025',
  tl2:'SCIA Presentata',tl2Date:'10/01/2026',
  tl3:'Richiesta Integrazioni',tl3Date:'25/01/2026',
  tl4:'Documenti Integrativi',tl4Date:'Scadenza: 25/02/2026',
  tl5:'Silenzio-Assenso',tl5Date:'Previsto: 10/03/2026',
  alertText:'Scadenza integrazioni tra 7 giorni \u2014 Documenti mancanti: Relazione strutturale, Nulla osta Soprintendenza',
  countdownText:'7 giorni rimanenti',
  g1Name:'Residenza Via Verdi',g1Date:'Gen\u2013Dic 2026',
  g2Name:'Palazzo Manzoni',g2Date:'Set 2025\u2013Apr 2026',
  g3Name:'Capannone ZAI',g3Date:'Mag 2025\u2013Lug 2026',
  g4Name:'Uffici Piazza Duomo',g4Date:'Gen 2025\u2013Feb 2026',
  aiSuggestion:'Ottimizzazione risorse: spostare il geometra dal progetto Uffici (in fase finale) al progetto Residenza per accelerare la fase progettuale',
  progressLabel:'Step {n} di 4'
}
};

var T = T_ALL[LOCALE] || T_ALL.it;

/* ----- State ----- */
var currentStep = 0;
var totalSteps = 4;
var demoTimers = [];
var detailOpen = false;

function dt(fn, ms) { var id = setTimeout(fn, ms); demoTimers.push(id); return id; }
function clearAllTimers() { demoTimers.forEach(clearTimeout); demoTimers = []; }

/* ----- i18n ----- */
function applyI18n() {
  document.querySelectorAll('[data-i18n]').forEach(function(el) {
    var k = el.getAttribute('data-i18n');
    if (T[k] !== undefined) el.textContent = T[k];
  });
  document.documentElement.lang = LOCALE;
}

/* ----- Progress ----- */
function updateProgress(step) {
  for (var i = 1; i <= totalSteps; i++) {
    var el = document.getElementById('pstep' + i);
    el.className = 'progress-step';
    if (i < step) el.classList.add('done');
    else if (i === step) el.classList.add('active');
  }
  document.getElementById('progressLabel').textContent = T.stepOf + ' ' + step + ' ' + T.of + ' ' + totalSteps;
  var btn = document.getElementById('btnNext');
  btn.disabled = step >= totalSteps;
  btn.textContent = step >= totalSteps ? (LOCALE === 'en' ? 'Complete' : 'Completato') : T.btnNext;
}

/* ----- Build Kanban ----- */
function buildKanban() {
  var cols = [
    {phase:'phase-design',title:T.col1,cards:[{title:T.card1Title,desc:T.card1Desc,client:T.card1Client}]},
    {phase:'phase-scia',title:T.col2,cards:[{title:T.card2Title,desc:T.card2Desc,client:T.card2Client,badge:T.card2Badge,badgeClass:'badge-amber'}]},
    {phase:'phase-cantiere',title:T.col3,cards:[{title:T.card3Title,desc:T.card3Desc,client:T.card3Client,progress:65}]},
    {phase:'phase-collaudo',title:T.col4,cards:[{title:T.card4Title,desc:T.card4Desc,client:T.card4Client,badge:T.card4Badge,badgeClass:'badge-purple'}]}
  ];
  var container = document.getElementById('kanban');
  container.innerHTML = '';
  cols.forEach(function(col) {
    var colEl = document.createElement('div');
    colEl.className = 'kanban-col';
    var headerEl = document.createElement('div');
    headerEl.className = 'kanban-col-header ' + col.phase;
    headerEl.innerHTML = '<span class="dot"></span> ' + col.title;
    colEl.appendChild(headerEl);
    col.cards.forEach(function(card) {
      var cardEl = document.createElement('div');
      cardEl.className = 'kanban-card';
      var html = '<div class="kanban-card-title">' + card.title + '</div>';
      html += '<div class="kanban-card-desc">' + card.desc + '</div>';
      html += '<div class="kanban-card-client">' + card.client + '</div>';
      if (card.badge) {
        html += '<div class="kanban-badge ' + card.badgeClass + '">' + card.badge + '</div>';
      }
      if (card.progress !== undefined) {
        html += '<div class="kanban-progress"><div class="kanban-progress-track"><div class="kanban-progress-fill" style="width:0%" data-target="' + card.progress + '"></div></div><div class="kanban-progress-label">' + card.progress + '%</div></div>';
      }
      cardEl.innerHTML = html;
      colEl.appendChild(cardEl);
    });
    container.appendChild(colEl);
  });
}

/* ----- Build Parameters ----- */
function buildParams() {
  var params = [
    {label:T.p1Label,value:T.p1Value,ok:true},
    {label:T.p2Label,value:T.p2Value,ok:true},
    {label:T.p3Label,value:T.p3Value,ok:true},
    {label:T.p4Label,value:T.p4Value,ok:true},
    {label:T.p5Label,value:T.p5Value,ok:false,clickable:true},
    {label:T.p6Label,value:T.p6Value,ok:true},
    {label:T.p7Label,value:T.p7Value,ok:true}
  ];
  var list = document.getElementById('paramList');
  list.innerHTML = '';
  params.forEach(function(p, i) {
    var row = document.createElement('div');
    row.className = 'param-row';
    row.setAttribute('data-index', i);
    if (!p.ok) row.classList.add('amber');
    if (p.clickable) row.classList.add('clickable');
    row.innerHTML =
      '<span class="param-label">' + p.label + '</span>' +
      '<span class="param-value">' + p.value + '</span>' +
      '<span class="param-status ' + (p.ok ? 'ok' : '') + '">' + (p.ok ? '\u2713' : '\u26A0') + '</span>';
    if (p.clickable) {
      row.title = T.clickHint;
      row.addEventListener('click', toggleDetail);
    }
    list.appendChild(row);
  });

  var dc = document.getElementById('paramDetailContainer');
  dc.innerHTML =
    '<div class="param-detail" id="paramDetail">' +
    '<div class="param-detail-title">' + T.detailTitle + '</div>' +
    '<p>' + T.detailCalc + '</p>' +
    '<p>' + T.detailLimit + '</p>' +
    '<p><strong>' + T.detailExcess + '</strong></p>' +
    '<p style="margin-top:10px;font-weight:700">' + T.detailSugTitle + '</p>' +
    '<div class="suggestion">' + T.detailSug1 + '</div>' +
    '<div class="suggestion">' + T.detailSug2 + '</div>' +
    '<div class="suggestion">' + T.detailSug3 + '</div>' +
    '</div>';
}

function toggleDetail() {
  var detail = document.getElementById('paramDetail');
  detailOpen = !detailOpen;
  if (detailOpen) {
    detail.classList.add('visible');
    var row = document.querySelector('.param-row.clickable');
    if (row) {
      row.style.animation = 'none';
    }
  } else {
    detail.classList.remove('visible');
  }
}

/* ----- Build Timeline ----- */
function buildTimeline() {
  var items = [
    {label:T.tl1,date:T.tl1Date,status:'done'},
    {label:T.tl2,date:T.tl2Date,status:'done'},
    {label:T.tl3,date:T.tl3Date,status:'current'},
    {label:T.tl4,date:T.tl4Date,status:'pending'},
    {label:T.tl5,date:T.tl5Date,status:'pending'}
  ];
  var container = document.getElementById('timelineItems');
  container.innerHTML = '';
  items.forEach(function(item, i) {
    var el = document.createElement('div');
    el.className = 'timeline-item';
    var dotIcon = item.status === 'done' ? '\u2713' : item.status === 'current' ? '\uD83D\uDD04' : '\u23F3';
    var lineClass = (i < items.length - 1) ? (item.status === 'done' ? ' done' : '') : '';
    var lineHtml = (i < items.length - 1) ? '<div class="timeline-line' + lineClass + '"></div>' : '';
    el.innerHTML =
      '<div class="timeline-dot-wrap">' +
      '<div class="timeline-dot ' + item.status + '">' + (item.status === 'done' ? '\u2713' : '') + '</div>' +
      lineHtml +
      '</div>' +
      '<div class="timeline-content">' +
      '<div class="timeline-content-label">' + item.label + '</div>' +
      '<div class="timeline-content-date">' + item.date + '</div>' +
      '</div>';
    container.appendChild(el);
  });
  document.getElementById('alertText').innerHTML = '<strong>' + T.alertText + '</strong>';
  document.getElementById('countdownBox').innerHTML = '\u23F0 ' + T.countdownText;
}

/* ----- Build Gantt ----- */
function buildGantt() {
  var rows = [
    {name:T.g1Name,date:T.g1Date,pct:45,colorClass:'c1'},
    {name:T.g2Name,date:T.g2Date,pct:75,colorClass:'c2'},
    {name:T.g3Name,date:T.g3Date,pct:65,colorClass:'c3'},
    {name:T.g4Name,date:T.g4Date,pct:95,colorClass:'c4'}
  ];
  var container = document.getElementById('ganttRows');
  container.innerHTML = '';
  rows.forEach(function(row) {
    var el = document.createElement('div');
    el.className = 'gantt-row';
    el.innerHTML =
      '<div class="gantt-label">' +
      '<div class="gantt-label-name">' + row.name + '</div>' +
      '<div class="gantt-label-date">' + row.date + '</div>' +
      '</div>' +
      '<div class="gantt-bar-track">' +
      '<div class="gantt-bar-fill ' + row.colorClass + '" style="width:0%" data-target="' + row.pct + '"></div>' +
      '</div>' +
      '<div class="gantt-pct">0%</div>';
    container.appendChild(el);
  });
  document.getElementById('aiText').innerHTML = '<strong>AI:</strong> ' + T.aiSuggestion;
}

/* ----- Animate Counters ----- */
function animateValue(el, target, suffix, duration) {
  duration = duration || 1000;
  var start = null;
  function step(ts) {
    if (!start) start = ts;
    var p = Math.min((ts - start) / duration, 1);
    var ease = 1 - Math.pow(1 - p, 3);
    el.textContent = Math.round(target * ease) + (suffix || '');
    if (p < 1) requestAnimationFrame(step);
  }
  requestAnimationFrame(step);
}

/* ----- Step Runners ----- */
function runStep1() {
  var sc = document.getElementById('step1');
  sc.classList.add('active');
  dt(function() {
    sc.style.opacity = '1';
    sc.style.transform = 'translateY(0)';
  }, 50);

  dt(function() {
    var fills = document.querySelectorAll('.kanban-progress-fill');
    fills.forEach(function(f) {
      f.style.width = f.getAttribute('data-target') + '%';
    });
  }, 600);
}

function runStep2() {
  var sc = document.getElementById('step2');
  sc.classList.add('active');
  dt(function() {
    sc.style.opacity = '1';
    sc.style.transform = 'translateY(0)';
  }, 50);

  var scanner = document.getElementById('scannerLine');
  scanner.classList.add('active');

  var rows = document.querySelectorAll('.param-row');
  rows.forEach(function(row, i) {
    dt(function() {
      row.classList.add('visible');
    }, 400 + i * 350);
  });

  dt(function() {
    scanner.classList.remove('active');
    document.getElementById('docStats').classList.add('visible');
  }, 400 + rows.length * 350 + 300);
}

function runStep3() {
  var sc = document.getElementById('step3');
  sc.classList.add('active');
  dt(function() {
    sc.style.opacity = '1';
    sc.style.transform = 'translateY(0)';
  }, 50);

  var items = document.querySelectorAll('.timeline-item');
  items.forEach(function(item, i) {
    dt(function() {
      item.style.opacity = '1';
    }, 200 + i * 400);
  });

  dt(function() {
    document.getElementById('alertBox').classList.add('visible');
  }, 200 + items.length * 400 + 300);

  dt(function() {
    document.getElementById('countdownBox').classList.add('visible');
  }, 200 + items.length * 400 + 800);
}

function runStep4() {
  var sc = document.getElementById('step4');
  sc.classList.add('active');
  dt(function() {
    sc.style.opacity = '1';
    sc.style.transform = 'translateY(0)';
  }, 50);

  var ganttFills = document.querySelectorAll('.gantt-bar-fill');
  var ganttPcts = document.querySelectorAll('.gantt-pct');
  ganttFills.forEach(function(fill, i) {
    dt(function() {
      var target = parseInt(fill.getAttribute('data-target'));
      fill.style.width = target + '%';
      animateValue(ganttPcts[i], target, '%', 1200);
    }, 300 + i * 250);
  });

  dt(function() {
    document.getElementById('aiSuggestion').classList.add('visible');
  }, 300 + ganttFills.length * 250 + 600);

  dt(function() {
    document.getElementById('resourceBar').classList.add('visible');
  }, 300 + ganttFills.length * 250 + 1000);

  dt(function() {
    document.getElementById('ctaFinal').classList.add('visible');
  }, 300 + ganttFills.length * 250 + 1400);
}

/* ----- Step Navigation ----- */
function goToStep(step) {
  if (step < 1 || step > totalSteps) return;
  currentStep = step;
  updateProgress(step);

  for (var i = 1; i <= totalSteps; i++) {
    var el = document.getElementById('step' + i);
    if (i === step) {
      el.style.display = 'block';
      dt(function(s) {
        return function() {
          s.style.opacity = '1';
          s.style.transform = 'translateY(0)';
        };
      }(el), 50);
    } else {
      el.classList.remove('active');
      el.style.display = 'none';
      el.style.opacity = '0';
      el.style.transform = 'translateY(16px)';
    }
  }

  switch(step) {
    case 1: runStep1(); break;
    case 2: runStep2(); break;
    case 3: runStep3(); break;
    case 4: runStep4(); break;
  }
}

document.getElementById('btnNext').addEventListener('click', function() {
  if (currentStep < totalSteps) {
    goToStep(currentStep + 1);
  }
});

/* ----- Reset for replay ----- */
function resetAll() {
  clearAllTimers();
  detailOpen = false;
  currentStep = 0;

  for (var i = 1; i <= totalSteps; i++) {
    var el = document.getElementById('step' + i);
    el.classList.remove('active');
    el.style.display = 'none';
    el.style.opacity = '0';
    el.style.transform = 'translateY(16px)';
  }

  document.querySelectorAll('.param-row').forEach(function(r) {
    r.classList.remove('visible');
  });
  document.getElementById('docStats').classList.remove('visible');
  var scanner = document.getElementById('scannerLine');
  scanner.classList.remove('active');
  var detail = document.getElementById('paramDetail');
  if (detail) detail.classList.remove('visible');
  var clickableRow = document.querySelector('.param-row.clickable');
  if (clickableRow) clickableRow.style.animation = '';

  document.getElementById('alertBox').classList.remove('visible');
  document.getElementById('countdownBox').classList.remove('visible');

  document.querySelectorAll('.gantt-bar-fill').forEach(function(f) { f.style.width = '0%'; });
  document.querySelectorAll('.gantt-pct').forEach(function(p) { p.textContent = '0%'; });
  document.getElementById('aiSuggestion').classList.remove('visible');
  document.getElementById('resourceBar').classList.remove('visible');
  document.getElementById('ctaFinal').classList.remove('visible');

  document.querySelectorAll('.kanban-progress-fill').forEach(function(f) { f.style.width = '0%'; });
}

/* ----- Init ----- */
function init() {
  applyI18n();
  buildKanban();
  buildParams();
  buildTimeline();
  buildGantt();
  goToStep(1);
}

init();

})();
</script>
</body>
</html>
