<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Praxis AI — Gestione Studio Dentistico</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Caveat:wght@700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --navy: #0f172a; --navy-light: #1e3a5f; --navy-muted: #334155;
  --silver: #94a3b8; --surface: #f0f4f8; --surface-light: #f8fafc;
  --surface-dark: #e2e8f0; --ice: #fafbfd; --border: #cbd5e1;
  --white: #ffffff; --accent-green: #16a34a; --accent-amber: #d97706; --accent-red: #dc2626;
  --font-body: 'Inter', system-ui, sans-serif; --font-display: 'Caveat', cursive;
  --shadow-sm: 0 1px 3px rgba(15,23,42,0.06);
  --shadow-md: 0 4px 12px rgba(15,23,42,0.08);
  --shadow-lg: 0 8px 30px rgba(15,23,42,0.12);
  --radius-sm: 8px; --radius-md: 12px; --radius-lg: 16px; --radius-xl: 20px;
}

html { font-size: 16px; }

body {
  font-family: var(--font-body);
  background: var(--surface);
  color: var(--navy);
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  -webkit-font-smoothing: antialiased;
}

/* ── Header ── */
.header {
  background: var(--white);
  border-bottom: 1px solid var(--border);
  padding: 14px 24px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: sticky; top: 0; z-index: 100;
  box-shadow: var(--shadow-sm);
}
.header-left { display: flex; align-items: center; gap: 12px; }
.logo {
  width: 34px; height: 34px; background: var(--navy);
  border-radius: 9px; display: flex; align-items: center;
  justify-content: center; color: var(--white); font-weight: 700; font-size: 16px;
}
.brand-name { font-family: var(--font-display); font-size: 24px; font-weight: 700; color: var(--navy); }
.header-title { font-size: 13px; color: var(--silver); font-weight: 500; display: flex; align-items: center; gap: 8px; }
.badge {
  background: #e0f2fe; color: var(--navy-light); font-size: 11px; font-weight: 600;
  padding: 3px 10px; border-radius: 20px; text-transform: uppercase; letter-spacing: 0.5px;
}

/* ── Progress Steps ── */
.progress-bar {
  display: flex; gap: 4px; padding: 16px 24px; background: var(--white);
  border-bottom: 1px solid var(--border); justify-content: center;
}
.step-pill {
  display: flex; align-items: center; gap: 6px; padding: 6px 16px;
  border-radius: 20px; font-size: 12px; font-weight: 600;
  background: var(--surface); color: var(--silver); transition: all 0.4s;
}
.step-pill.active { background: var(--navy); color: var(--white); }
.step-pill.done { background: #dcfce7; color: var(--accent-green); }
.step-num {
  width: 20px; height: 20px; border-radius: 50%; display: flex;
  align-items: center; justify-content: center; font-size: 11px; font-weight: 700;
  background: rgba(148,163,184,0.2);
}
.step-pill.active .step-num { background: rgba(255,255,255,0.2); }
.step-pill.done .step-num { background: rgba(22,163,74,0.2); }

/* ── Main Content ── */
.main { flex: 1; max-width: 960px; width: 100%; margin: 20px auto; padding: 0 20px; }

.step-container { display: none; animation: fadeUp 0.5s ease; }
.step-container.visible { display: block; }

@keyframes fadeUp {
  from { opacity: 0; transform: translateY(16px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ── Step 1: Calendar ── */
.calendar-wrapper {
  background: var(--white); border-radius: var(--radius-lg);
  border: 1px solid var(--border); box-shadow: var(--shadow-md); overflow: hidden;
}
.calendar-header {
  padding: 16px 20px; border-bottom: 1px solid var(--border);
  display: flex; align-items: center; justify-content: space-between;
}
.calendar-header h3 { font-size: 16px; font-weight: 700; }
.calendar-grid {
  display: grid; grid-template-columns: 60px repeat(5, 1fr);
  min-height: 420px; position: relative;
}
.day-header {
  padding: 10px 8px; text-align: center; font-size: 12px; font-weight: 700;
  color: var(--navy); border-bottom: 1px solid var(--border);
  background: var(--surface-light); text-transform: uppercase;
}
.time-col {
  border-right: 1px solid var(--border); background: var(--surface-light);
}
.time-label {
  height: 40px; display: flex; align-items: center; justify-content: flex-end;
  padding-right: 8px; font-size: 10px; color: var(--silver); font-weight: 500;
}
.day-col {
  position: relative; border-right: 1px solid var(--border);
  min-height: 400px;
}
.day-col:last-child { border-right: none; }
.hour-line {
  position: absolute; left: 0; right: 0; height: 1px;
  background: var(--surface-dark);
}
.appt-card {
  position: absolute; left: 3px; right: 3px; border-radius: 6px;
  padding: 4px 7px; font-size: 10px; line-height: 1.3; overflow: hidden;
  cursor: default; transition: all 0.8s cubic-bezier(0.4,0,0.2,1);
  border: 1px solid transparent; z-index: 2;
}
.appt-card .appt-name { font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.appt-card .appt-proc { opacity: 0.8; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.appt-card.blue { background: #dbeafe; border-color: #93c5fd; color: #1e40af; }
.appt-card.green { background: #dcfce7; border-color: #86efac; color: #166534; }
.appt-card.amber { background: #fef3c7; border-color: #fcd34d; color: #92400e; }
.appt-card.purple { background: #ede9fe; border-color: #c4b5fd; color: #5b21b6; }
.appt-card.light-blue { background: #e0f2fe; border-color: #7dd3fc; color: #0c4a6e; }
.appt-card.empty {
  background: var(--surface-light); border: 2px dashed var(--border);
  color: var(--silver); display: flex; align-items: center; justify-content: center;
  font-weight: 600; font-style: italic;
}
.appt-card.conflict {
  background: #fef2f2; border: 2px solid var(--accent-red); color: var(--accent-red);
  animation: pulse-conflict 1.5s ease-in-out infinite;
}
@keyframes pulse-conflict {
  0%, 100% { box-shadow: 0 0 0 0 rgba(220,38,38,0.3); }
  50% { box-shadow: 0 0 0 6px rgba(220,38,38,0); }
}

.appt-card.interactive { cursor: pointer; }
.appt-card .info-icon {
  position: absolute; top: 4px; right: 4px; width: 16px; height: 16px;
  border-radius: 50%; background: rgba(91,33,182,0.2); color: #5b21b6;
  display: flex; align-items: center; justify-content: center;
  font-size: 10px; font-weight: 700; animation: pulse-info 2s ease-in-out infinite;
}
@keyframes pulse-info {
  0%, 100% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.2); opacity: 0.7; }
}

/* ── Stats Bar ── */
.stats-bar {
  display: flex; gap: 16px; padding: 14px 20px; background: var(--surface-light);
  border-top: 1px solid var(--border); flex-wrap: wrap; justify-content: center;
}
.stat-item {
  display: flex; align-items: center; gap: 6px; font-size: 13px; font-weight: 600;
}
.stat-dot { width: 8px; height: 8px; border-radius: 50%; }
.stat-dot.red { background: var(--accent-red); }
.stat-dot.amber { background: var(--accent-amber); }
.stat-dot.green { background: var(--accent-green); }
.stat-dot.blue { background: #3b82f6; }

/* ── Patient Detail Overlay ── */
.patient-overlay {
  display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(15,23,42,0.5); z-index: 200; align-items: center; justify-content: center;
  animation: fadeIn 0.3s ease;
}
.patient-overlay.visible { display: flex; }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
.patient-card {
  background: var(--white); border-radius: var(--radius-lg); padding: 28px;
  max-width: 440px; width: 90%; box-shadow: var(--shadow-lg);
  animation: scaleIn 0.35s cubic-bezier(0.16,1,0.3,1);
}
@keyframes scaleIn {
  from { opacity: 0; transform: scale(0.92); }
  to { opacity: 1; transform: scale(1); }
}
.patient-card h3 { font-size: 18px; font-weight: 700; margin-bottom: 4px; }
.patient-card .patient-since { font-size: 13px; color: var(--silver); margin-bottom: 16px; }
.patient-card .detail-row {
  display: flex; gap: 10px; padding: 10px 0; border-bottom: 1px solid var(--surface-dark);
  font-size: 13px; line-height: 1.5;
}
.patient-card .detail-row:last-child { border-bottom: none; }
.detail-label { font-weight: 600; color: var(--navy); min-width: 120px; flex-shrink: 0; }
.detail-value { color: var(--navy-muted); }
.patient-card .close-btn {
  position: absolute; top: -8px; right: -8px; width: 28px; height: 28px;
  border-radius: 50%; background: var(--navy); color: var(--white);
  border: none; cursor: pointer; font-size: 14px; display: flex;
  align-items: center; justify-content: center;
}
.patient-card-wrap { position: relative; }

/* ── Step 3: Messages ── */
.msg-card {
  background: var(--white); border-radius: var(--radius-md);
  border: 1px solid var(--border); padding: 18px; margin-bottom: 14px;
  box-shadow: var(--shadow-sm); opacity: 0; transform: translateX(-30px);
  transition: all 0.6s cubic-bezier(0.16,1,0.3,1);
}
.msg-card.visible { opacity: 1; transform: translateX(0); }
.msg-card .msg-type {
  font-size: 14px; font-weight: 700; margin-bottom: 8px;
  display: flex; align-items: center; gap: 8px;
}
.msg-card .msg-body { font-size: 13px; color: var(--navy-muted); line-height: 1.6; margin-bottom: 10px; }
.msg-status {
  display: inline-flex; align-items: center; gap: 5px; font-size: 12px;
  font-weight: 600; padding: 3px 10px; border-radius: 12px;
}
.msg-status.sent { background: #dcfce7; color: #166534; }
.msg-status.queued { background: #fef3c7; color: #92400e; }
.msg-status.draft { background: var(--surface); color: var(--silver); }

/* ── Step 4: Clinical Notes ── */
.note-form {
  background: var(--white); border-radius: var(--radius-lg);
  border: 1px solid var(--border); box-shadow: var(--shadow-md); overflow: hidden;
}
.note-header {
  padding: 16px 20px; border-bottom: 1px solid var(--border);
  display: flex; align-items: center; gap: 10px;
}
.note-header h3 { font-size: 16px; font-weight: 700; }
.mic-icon {
  width: 28px; height: 28px; border-radius: 50%; background: var(--accent-red);
  display: flex; align-items: center; justify-content: center; color: var(--white);
  font-size: 13px; animation: pulse-mic 1.5s ease-in-out infinite;
}
@keyframes pulse-mic {
  0%, 100% { box-shadow: 0 0 0 0 rgba(220,38,38,0.4); }
  50% { box-shadow: 0 0 0 8px rgba(220,38,38,0); }
}
.dictation-area {
  padding: 20px; font-size: 14px; color: var(--navy-muted);
  line-height: 1.7; min-height: 60px; border-bottom: 1px solid var(--border);
  font-style: italic;
}
.dictation-area .cursor-blink {
  display: inline-block; width: 2px; height: 16px; background: var(--navy);
  animation: blink 0.7s step-end infinite; vertical-align: text-bottom; margin-left: 2px;
}
@keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
.structured-note {
  padding: 20px; display: none;
}
.structured-note.visible { display: block; animation: fadeUp 0.6s ease; }
.note-section {
  margin-bottom: 14px; padding: 14px; border-radius: var(--radius-sm);
  background: var(--surface-light); border-left: 3px solid var(--navy);
  opacity: 0; transform: translateY(10px);
  transition: all 0.5s cubic-bezier(0.16,1,0.3,1);
}
.note-section.visible { opacity: 1; transform: translateY(0); }
.note-section h4 {
  font-size: 12px; font-weight: 700; text-transform: uppercase;
  letter-spacing: 0.5px; color: var(--navy); margin-bottom: 6px;
}
.note-section p { font-size: 13px; color: var(--navy-muted); line-height: 1.6; }
.note-section.diagnosis { border-left-color: var(--accent-red); }
.note-section.plan { border-left-color: var(--accent-green); }

/* ── CTA ── */
.cta-bar {
  text-align: center; padding: 28px 20px; margin-top: 20px;
  opacity: 0; transition: opacity 0.6s ease;
}
.cta-bar.visible { opacity: 1; }
.cta-btn {
  display: inline-flex; align-items: center; gap: 8px;
  padding: 14px 32px; background: var(--navy); color: var(--white);
  border: none; border-radius: var(--radius-xl); font-size: 15px;
  font-weight: 700; cursor: pointer; font-family: var(--font-body);
  transition: all 0.3s; box-shadow: var(--shadow-md);
}
.cta-btn:hover { background: var(--navy-light); transform: translateY(-1px); box-shadow: var(--shadow-lg); }

/* ── Optimization Counter ── */
.opt-counter {
  text-align: center; padding: 16px; font-size: 20px; font-weight: 700;
  color: var(--accent-green); font-family: var(--font-display);
  opacity: 0; transition: opacity 0.5s;
}
.opt-counter.visible { opacity: 1; }

/* ── Responsive ── */
@media (max-width: 640px) {
  .header { padding: 12px 16px; }
  .brand-name { font-size: 20px; }
  .progress-bar { padding: 12px 16px; gap: 3px; }
  .step-pill { padding: 5px 10px; font-size: 10px; }
  .step-label { display: none; }
  .main { padding: 0 12px; margin: 12px auto; }
  .calendar-grid { grid-template-columns: 42px repeat(5, 1fr); }
  .appt-card { font-size: 9px; padding: 3px 4px; }
  .stats-bar { font-size: 11px; gap: 10px; }
  .patient-card { padding: 20px; }
}
</style>
</head>
<body>

<!-- Header -->
<div class="header">
  <div class="header-left">
    <div class="logo">P</div>
    <span class="brand-name">Praxis AI</span>
  </div>
  <div class="header-title">
    <span data-i18n="headerTitle">Gestione Studio Dentistico</span>
    <span class="badge" data-i18n="badgeDemo">Demo</span>
  </div>
</div>

<!-- Progress Bar -->
<div class="progress-bar">
  <div class="step-pill active" data-step="1">
    <span class="step-num">1</span>
    <span class="step-label" data-i18n="step1Label">Calendario</span>
  </div>
  <div class="step-pill" data-step="2">
    <span class="step-num">2</span>
    <span class="step-label" data-i18n="step2Label">Ottimizzazione</span>
  </div>
  <div class="step-pill" data-step="3">
    <span class="step-num">3</span>
    <span class="step-label" data-i18n="step3Label">Comunicazioni</span>
  </div>
  <div class="step-pill" data-step="4">
    <span class="step-num">4</span>
    <span class="step-label" data-i18n="step4Label">Note Cliniche</span>
  </div>
</div>

<!-- Main Content -->
<div class="main">

  <!-- Step 1: Weekly Calendar -->
  <div class="step-container visible" id="step1">
    <div class="calendar-wrapper">
      <div class="calendar-header">
        <h3 data-i18n="calendarTitle">Agenda Settimanale</h3>
        <span style="font-size:12px;color:var(--silver)">17-21 Feb 2026</span>
      </div>
      <div class="calendar-grid" id="calendarGrid">
        <!-- Built by JS -->
      </div>
      <div class="stats-bar" id="stats1">
        <!-- Built by JS -->
      </div>
    </div>
  </div>

  <!-- Step 2: Optimization -->
  <div class="step-container" id="step2">
    <div class="calendar-wrapper">
      <div class="calendar-header">
        <h3 data-i18n="optimizedTitle">Agenda Ottimizzata con AI</h3>
        <span style="font-size:12px;color:var(--accent-green);font-weight:600" data-i18n="aiOptimized">Ottimizzata</span>
      </div>
      <div class="calendar-grid" id="calendarGrid2">
        <!-- Built by JS -->
      </div>
      <div class="stats-bar" id="stats2"></div>
    </div>
    <div class="opt-counter" id="optCounter"></div>
  </div>

  <!-- Step 3: Patient Communication -->
  <div class="step-container" id="step3">
    <div style="margin-bottom:16px">
      <h3 style="font-size:18px;font-weight:700" data-i18n="commTitle">Comunicazioni Pazienti</h3>
      <p style="font-size:13px;color:var(--silver);margin-top:4px" data-i18n="commSubtitle">Messaggi generati automaticamente dall'AI</p>
    </div>
    <div id="msgContainer"></div>
    <div class="stats-bar" id="stats3" style="background:var(--white);border-radius:var(--radius-md);border:1px solid var(--border);margin-top:8px"></div>
  </div>

  <!-- Step 4: Clinical Notes -->
  <div class="step-container" id="step4">
    <div class="note-form">
      <div class="note-header">
        <div class="mic-icon" id="micIcon">&#9679;</div>
        <h3 data-i18n="noteTitle">Cartella Clinica — Dettatura Vocale</h3>
      </div>
      <div class="dictation-area" id="dictationArea"></div>
      <div class="structured-note" id="structuredNote"></div>
    </div>
    <div class="cta-bar" id="ctaBar">
      <button class="cta-btn" data-i18n="ctaText">Vuoi ottimizzare il tuo studio?</button>
    </div>
  </div>

</div>

<!-- Patient Detail Overlay -->
<div class="patient-overlay" id="patientOverlay">
  <div class="patient-card-wrap">
    <div class="patient-card" id="patientCard"></div>
  </div>
</div>

<script>
(function() {
  'use strict';

  /* ── i18n ── */
  var LOCALE = window.__PRAXIS_LOCALE__ || 'it';
  var T = {
    en: {
      headerTitle: 'Dental Practice Management',
      badgeDemo: 'Demo',
      step1Label: 'Calendar',
      step2Label: 'Optimization',
      step3Label: 'Communications',
      step4Label: 'Clinical Notes',
      calendarTitle: 'Weekly Schedule',
      optimizedTitle: 'AI-Optimized Schedule',
      aiOptimized: 'Optimized',
      commTitle: 'Patient Communications',
      commSubtitle: 'Messages auto-generated by AI',
      noteTitle: 'Clinical Record \u2014 Voice Dictation',
      ctaText: 'Want to optimize your practice?',
      days: ['Mon','Tue','Wed','Thu','Fri'],
      empty: 'EMPTY',
      conflict: 'CONFLICT',
      statsEmpty: '{n} empty slots',
      statsConflict: '{n} conflict',
      statsAppts: '{n} appointments',
      optTime: 'Time optimized: +3.5 hours/week',
      statsEmpty2: '0 empty slots',
      statsConflict2: '0 conflicts',
      statsAppts2: '15 appointments (+25%)',
      patientName: 'Sofia Russo',
      patientSince: 'Patient since 2019',
      lastTreatment: 'Last treatment',
      lastTreatmentVal: 'Dental cleaning (01/15/2026)',
      nextRecommended: 'Next recommended',
      nextRecommendedVal: 'X-ray check (due: 07/15/2026)',
      reminderStatus: 'Reminder status',
      reminderStatusVal: 'SMS sent 48h before \u2713 \u2014 Confirmation received \u2713',
      treatmentPlan: 'Treatment plan',
      treatmentPlanVal: 'Dental implant (phase 2 of 3)',
      msg1Type: '\uD83D\uDCF1 Appointment Reminder',
      msg1Body: 'Dear Sofia, we remind you of your appointment for Dental implant on Wednesday 02/19 at 10:00 AM. To confirm, reply YES.',
      msg1Status: 'Sent',
      msg2Type: '\uD83D\uDCCB Semi-annual Recall',
      msg2Body: 'Dear Roberto, the recommended period for your semi-annual dental cleaning has passed. We suggest an appointment on...',
      msg2Status: 'Queued',
      msg3Type: '\uD83D\uDCB0 Treatment Estimate',
      msg3Body: 'Dear Luca, here is the estimate for the Extraction + Implant treatment: \u20AC2,800.00 (installment plan available)...',
      msg3Status: 'Draft',
      commStats: '3 communications generated \u2014 1 sent, 1 queued, 1 draft',
      dictationText: 'Patient presents acute pain in molar 36, onset 3 days ago, worsened by chewing. Deep mesio-distal cavity observed, negative vitality test, positive percussion.',
      noteAnamnesi: 'History',
      noteAnamnesiVal: 'Acute pain molar 36, onset 3 days ago, exacerbated by chewing',
      noteEsame: 'Clinical Exam',
      noteEsameVal: 'Deep mesio-distal cavity, negative vitality test, positive percussion',
      noteDiagnosi: 'Diagnosis',
      noteDiagnosiVal: 'Irreversible pulpitis molar 36',
      notePiano: 'Treatment Plan',
      notePianoVal: '1. Root canal \u2014 2. Post and core buildup \u2014 3. Prosthetic crown',
      noteNote: 'Notes',
      noteNoteVal: 'Informed consent obtained. Next appointment: root canal treatment'
    },
    it: {
      headerTitle: 'Gestione Studio Dentistico',
      badgeDemo: 'Demo',
      step1Label: 'Calendario',
      step2Label: 'Ottimizzazione',
      step3Label: 'Comunicazioni',
      step4Label: 'Note Cliniche',
      calendarTitle: 'Agenda Settimanale',
      optimizedTitle: 'Agenda Ottimizzata con AI',
      aiOptimized: 'Ottimizzata',
      commTitle: 'Comunicazioni Pazienti',
      commSubtitle: 'Messaggi generati automaticamente dall\'AI',
      noteTitle: 'Cartella Clinica \u2014 Dettatura Vocale',
      ctaText: 'Vuoi ottimizzare il tuo studio?',
      days: ['Lun','Mar','Mer','Gio','Ven'],
      empty: 'VUOTO',
      conflict: 'CONFLITTO',
      statsEmpty: '{n} slot vuoti',
      statsConflict: '{n} conflitto',
      statsAppts: '{n} appuntamenti',
      optTime: 'Tempo ottimizzato: +3,5 ore/settimana',
      statsEmpty2: '0 slot vuoti',
      statsConflict2: '0 conflitti',
      statsAppts2: '15 appuntamenti (+25%)',
      patientName: 'Sofia Russo',
      patientSince: 'Paziente dal 2019',
      lastTreatment: 'Ultimo trattamento',
      lastTreatmentVal: 'Pulizia dentale (15/01/2026)',
      nextRecommended: 'Prossimo consigliato',
      nextRecommendedVal: 'Controllo radiografico (scadenza: 15/07/2026)',
      reminderStatus: 'Stato promemoria',
      reminderStatusVal: 'SMS inviato 48h prima \u2713 \u2014 Conferma ricevuta \u2713',
      treatmentPlan: 'Piano terapeutico',
      treatmentPlanVal: 'Impianto dentale (fase 2 di 3)',
      msg1Type: '\uD83D\uDCF1 Promemoria Appuntamento',
      msg1Body: 'Gentile Sofia, le ricordiamo l\'appuntamento per Impianto dentale mercoled\u00ec 19/02 alle ore 10:00. Per confermare risponda SI.',
      msg1Status: 'Inviato',
      msg2Type: '\uD83D\uDCCB Richiamo Semestrale',
      msg2Body: 'Gentile Roberto, \u00e8 trascorso il periodo consigliato per la pulizia dentale semestrale. Le proponiamo un appuntamento il...',
      msg2Status: 'In coda',
      msg3Type: '\uD83D\uDCB0 Preventivo Trattamento',
      msg3Body: 'Gentile Luca, di seguito il preventivo per il trattamento di Estrazione + Impianto: \u20AC2.800,00 (possibilit\u00e0 di rateizzazione)...',
      msg3Status: 'Bozza',
      commStats: '3 comunicazioni generate \u2014 1 inviata, 1 in coda, 1 bozza',
      dictationText: 'Paziente presenta dolore acuto al molare 36, insorgenza 3 giorni fa, esacerbato dalla masticazione. Carie profonda mesio-distale, test vitalit\u00e0 negativo, percussione positiva.',
      noteAnamnesi: 'Anamnesi',
      noteAnamnesiVal: 'Dolore acuto molare 36, insorgenza 3 giorni fa, esacerbato dalla masticazione',
      noteEsame: 'Esame Obiettivo',
      noteEsameVal: 'Carie profonda mesio-distale, test vitalit\u00e0 negativo, percussione positiva',
      noteDiagnosi: 'Diagnosi',
      noteDiagnosiVal: 'Pulpite irreversibile molare 36',
      notePiano: 'Piano Terapeutico',
      notePianoVal: '1. Devitalizzazione \u2014 2. Ricostruzione con perno moncone \u2014 3. Corona protesica',
      noteNote: 'Note',
      noteNoteVal: 'Consenso informato acquisito. Prossimo appuntamento: devitalizzazione'
    }
  };
  var t = T[LOCALE] || T.it;

  /* Apply static i18n */
  document.querySelectorAll('[data-i18n]').forEach(function(el) {
    var key = el.getAttribute('data-i18n');
    if (t[key]) el.textContent = t[key];
  });

  /* ── Calendar Data ── */
  var HOUR_H = 40; /* px per hour slot */
  var START_HOUR = 8;
  var END_HOUR = 18;
  var HOURS = [];
  for (var h = START_HOUR; h <= END_HOUR; h++) HOURS.push(h);

  function timeToY(hour, min) {
    return ((hour - START_HOUR) * HOUR_H) + ((min || 0) / 60 * HOUR_H);
  }
  function durationToH(mins) {
    return (mins / 60) * HOUR_H;
  }

  /* Original appointments: day(0=Mon), hour, min, duration(min), name, procedure, color, id */
  var APPTS_ORIG = [
    { day:0, h:9, m:0, dur:30, name:'Maria G.', proc:LOCALE==='en'?'Dental cleaning':'Pulizia dentale', color:'light-blue', id:'maria' },
    { day:0, h:10, m:0, dur:40, name:'', proc:'', color:'empty', id:'empty1', isEmpty:true },
    { day:0, h:11, m:0, dur:45, name:'Roberto F.', proc:LOCALE==='en'?'Filling':'Otturazione', color:'green', id:'roberto' },
    { day:1, h:9, m:0, dur:20, name:'Anna P.', proc:LOCALE==='en'?'Check-up':'Visita di controllo', color:'blue', id:'anna' },
    { day:1, h:9, m:0, dur:30, name:'', proc:'', color:'conflict', id:'conflict1', isConflict:true },
    { day:1, h:14, m:0, dur:60, name:'Luca M.', proc:LOCALE==='en'?'Extraction':'Estrazione', color:'amber', id:'luca' },
    { day:2, h:10, m:0, dur:90, name:'Sofia R.', proc:LOCALE==='en'?'Dental implant':'Impianto dentale', color:'purple', id:'sofia', interactive:true },
    { day:2, h:15, m:0, dur:40, name:'', proc:'', color:'empty', id:'empty2', isEmpty:true },
    { day:3, h:9, m:0, dur:60, name:'Marco B.', proc:LOCALE==='en'?'Crown':'Corona', color:'green', id:'marco' },
    { day:3, h:14, m:0, dur:45, name:'Elena D.', proc:LOCALE==='en'?'Whitening':'Sbiancamento', color:'blue', id:'elena' },
    { day:4, h:9, m:0, dur:40, name:'', proc:'', color:'empty', id:'empty3', isEmpty:true },
    { day:4, h:11, m:0, dur:60, name:'Giorgio T.', proc:LOCALE==='en'?'Root canal':'Devitalizzazione', color:'amber', id:'giorgio' }
  ];

  /* Optimized: conflict resolved, empties filled, grouped */
  var APPTS_OPT = [
    { day:0, h:9, m:0, dur:30, name:'Maria G.', proc:LOCALE==='en'?'Dental cleaning':'Pulizia dentale', color:'light-blue', id:'maria' },
    { day:0, h:10, m:0, dur:20, name:'Anna P.', proc:LOCALE==='en'?'Check-up':'Visita di controllo', color:'blue', id:'anna' },
    { day:0, h:11, m:0, dur:45, name:'Roberto F.', proc:LOCALE==='en'?'Filling':'Otturazione', color:'green', id:'roberto' },
    { day:1, h:9, m:0, dur:60, name:'Luca M.', proc:LOCALE==='en'?'Extraction':'Estrazione', color:'amber', id:'luca' },
    { day:1, h:10, m:30, dur:60, name:'Paolo V.', proc:LOCALE==='en'?'Extraction':'Estrazione', color:'amber', id:'paolo' },
    { day:1, h:14, m:0, dur:20, name:'Carla S.', proc:LOCALE==='en'?'Check-up':'Visita di controllo', color:'blue', id:'carla' },
    { day:2, h:10, m:0, dur:90, name:'Sofia R.', proc:LOCALE==='en'?'Dental implant':'Impianto dentale', color:'purple', id:'sofia', interactive:true },
    { day:2, h:15, m:0, dur:45, name:'Giulia N.', proc:LOCALE==='en'?'Dental cleaning':'Pulizia dentale', color:'light-blue', id:'giulia' },
    { day:3, h:9, m:0, dur:60, name:'Marco B.', proc:LOCALE==='en'?'Crown':'Corona', color:'green', id:'marco' },
    { day:3, h:14, m:0, dur:45, name:'Elena D.', proc:LOCALE==='en'?'Whitening':'Sbiancamento', color:'blue', id:'elena' },
    { day:3, h:15, m:0, dur:20, name:'Lucia F.', proc:LOCALE==='en'?'Check-up':'Visita di controllo', color:'blue', id:'lucia' },
    { day:4, h:9, m:0, dur:30, name:'Teresa M.', proc:LOCALE==='en'?'Dental cleaning':'Pulizia dentale', color:'light-blue', id:'teresa' },
    { day:4, h:10, m:0, dur:20, name:'Fabio R.', proc:LOCALE==='en'?'Check-up':'Visita di controllo', color:'blue', id:'fabio' },
    { day:4, h:11, m:0, dur:60, name:'Giorgio T.', proc:LOCALE==='en'?'Root canal':'Devitalizzazione', color:'amber', id:'giorgio' },
    { day:4, h:14, m:0, dur:45, name:'Alessia B.', proc:LOCALE==='en'?'Filling':'Otturazione', color:'green', id:'alessia' }
  ];

  /* ── Build Calendar Grid ── */
  function buildCalendar(containerId, appointments, statsId, isOptimized) {
    var grid = document.getElementById(containerId);
    grid.innerHTML = '';

    /* Time column header */
    var corner = document.createElement('div');
    corner.className = 'day-header';
    corner.textContent = '';
    grid.appendChild(corner);

    /* Day headers */
    t.days.forEach(function(day) {
      var dh = document.createElement('div');
      dh.className = 'day-header';
      dh.textContent = day;
      grid.appendChild(dh);
    });

    /* Time column */
    var timeCol = document.createElement('div');
    timeCol.className = 'time-col';
    HOURS.forEach(function(hour) {
      var lbl = document.createElement('div');
      lbl.className = 'time-label';
      lbl.textContent = (hour < 10 ? '0' : '') + hour + ':00';
      timeCol.appendChild(lbl);
    });
    grid.appendChild(timeCol);

    /* Day columns */
    for (var d = 0; d < 5; d++) {
      var col = document.createElement('div');
      col.className = 'day-col';
      col.setAttribute('data-day', d);

      /* Hour lines */
      HOURS.forEach(function(hour) {
        var line = document.createElement('div');
        line.className = 'hour-line';
        line.style.top = timeToY(hour, 0) + 'px';
        col.appendChild(line);
      });

      /* Appointments for this day */
      appointments.forEach(function(appt) {
        if (appt.day !== d) return;
        var card = document.createElement('div');
        card.className = 'appt-card ' + appt.color;
        if (appt.interactive) card.classList.add('interactive');
        card.style.top = timeToY(appt.h, appt.m) + 'px';
        card.style.height = durationToH(appt.dur) + 'px';
        card.setAttribute('data-id', appt.id);

        if (appt.isEmpty) {
          card.textContent = t.empty;
        } else if (appt.isConflict) {
          card.innerHTML = '<div class="appt-name">\u26A0 ' + t.conflict + '</div>';
        } else {
          card.innerHTML = '<div class="appt-name">' + appt.name + '</div><div class="appt-proc">' + appt.proc + '</div>';
          if (appt.interactive) {
            card.innerHTML += '<div class="info-icon">i</div>';
            card.addEventListener('click', showPatientDetail);
          }
        }
        col.appendChild(card);
      });

      grid.appendChild(col);
    }

    /* Stats */
    var statsEl = document.getElementById(statsId);
    if (!isOptimized) {
      statsEl.innerHTML =
        '<div class="stat-item"><span class="stat-dot amber"></span>' + t.statsEmpty.replace('{n}', '3') + '</div>' +
        '<div class="stat-item"><span class="stat-dot red"></span>' + t.statsConflict.replace('{n}', '1') + '</div>' +
        '<div class="stat-item"><span class="stat-dot blue"></span>' + t.statsAppts.replace('{n}', '12') + '</div>';
    } else {
      statsEl.innerHTML =
        '<div class="stat-item"><span class="stat-dot green"></span>' + t.statsEmpty2 + '</div>' +
        '<div class="stat-item"><span class="stat-dot green"></span>' + t.statsConflict2 + '</div>' +
        '<div class="stat-item"><span class="stat-dot green"></span>' + t.statsAppts2 + '</div>';
    }
  }

  /* ── Patient Detail ── */
  function showPatientDetail() {
    var overlay = document.getElementById('patientOverlay');
    var card = document.getElementById('patientCard');
    card.innerHTML =
      '<h3>' + t.patientName + '</h3>' +
      '<div class="patient-since">' + t.patientSince + '</div>' +
      '<div class="detail-row"><span class="detail-label">' + t.lastTreatment + '</span><span class="detail-value">' + t.lastTreatmentVal + '</span></div>' +
      '<div class="detail-row"><span class="detail-label">' + t.nextRecommended + '</span><span class="detail-value">' + t.nextRecommendedVal + '</span></div>' +
      '<div class="detail-row"><span class="detail-label">' + t.reminderStatus + '</span><span class="detail-value">' + t.reminderStatusVal + '</span></div>' +
      '<div class="detail-row"><span class="detail-label">' + t.treatmentPlan + '</span><span class="detail-value">' + t.treatmentPlanVal + '</span></div>';
    overlay.classList.add('visible');
  }

  document.getElementById('patientOverlay').addEventListener('click', function(e) {
    if (e.target === this || e.target.classList.contains('patient-card-wrap')) {
      this.classList.remove('visible');
    }
  });

  /* ── Step Management ── */
  var currentStep = 0;
  var steps = [
    document.getElementById('step1'),
    document.getElementById('step2'),
    document.getElementById('step3'),
    document.getElementById('step4')
  ];
  var pills = document.querySelectorAll('.step-pill');

  function showStep(n) {
    steps.forEach(function(s, i) {
      s.classList.toggle('visible', i === n);
    });
    pills.forEach(function(p, i) {
      p.classList.remove('active', 'done');
      if (i < n) p.classList.add('done');
      if (i === n) p.classList.add('active');
    });
    currentStep = n;
  }

  /* ── Build Step 1 Calendar ── */
  buildCalendar('calendarGrid', APPTS_ORIG, 'stats1', false);

  /* ── Auto-play Timeline ── */
  var STEP1_DISPLAY = 3500;
  var STEP2_ANIM = 4000;
  var STEP3_DISPLAY = 6000;

  /* Step 1 -> Step 2 */
  setTimeout(function() {
    showStep(1);
    buildCalendar('calendarGrid2', APPTS_OPT, 'stats2', true);

    /* Animate optimization counter */
    var counter = document.getElementById('optCounter');
    setTimeout(function() {
      counter.textContent = t.optTime;
      counter.classList.add('visible');
    }, 800);

  }, STEP1_DISPLAY);

  /* Step 2 -> Step 3 */
  setTimeout(function() {
    showStep(2);
    buildMessages();
  }, STEP1_DISPLAY + STEP2_ANIM);

  /* ── Step 3: Messages ── */
  function buildMessages() {
    var container = document.getElementById('msgContainer');
    var messages = [
      { type: t.msg1Type, body: t.msg1Body, status: t.msg1Status, statusClass: 'sent' },
      { type: t.msg2Type, body: t.msg2Body, status: t.msg2Status, statusClass: 'queued' },
      { type: t.msg3Type, body: t.msg3Body, status: t.msg3Status, statusClass: 'draft' }
    ];

    container.innerHTML = '';
    messages.forEach(function(msg, i) {
      var card = document.createElement('div');
      card.className = 'msg-card';
      card.innerHTML =
        '<div class="msg-type">' + msg.type + '</div>' +
        '<div class="msg-body">' + msg.body + '</div>' +
        '<span class="msg-status ' + msg.statusClass + '">' +
        (msg.statusClass === 'sent' ? '\u2713 ' : '') + msg.status + '</span>';
      container.appendChild(card);

      setTimeout(function() {
        card.classList.add('visible');
      }, 400 + i * 700);
    });

    /* Stats for step 3 */
    setTimeout(function() {
      var stats3 = document.getElementById('stats3');
      stats3.innerHTML = '<div class="stat-item" style="justify-content:center;width:100%">' + t.commStats + '</div>';
    }, 400 + 3 * 700);

    /* Move to step 4 */
    setTimeout(function() {
      showStep(3);
      runDictation();
    }, STEP3_DISPLAY);
  }

  /* ── Step 4: Clinical Notes with Voice Dictation ── */
  function runDictation() {
    var area = document.getElementById('dictationArea');
    var fullText = t.dictationText;
    var words = fullText.split(' ');
    var idx = 0;
    var displayed = '';

    area.innerHTML = '<span class="cursor-blink"></span>';

    var dictInterval = setInterval(function() {
      if (idx >= words.length) {
        clearInterval(dictInterval);
        area.innerHTML = '<span style="font-style:italic;color:var(--navy-muted)">' + displayed.trim() + '</span>';
        /* Hide mic pulse */
        document.getElementById('micIcon').style.animation = 'none';
        document.getElementById('micIcon').style.background = 'var(--silver)';
        /* Show structured notes */
        setTimeout(buildStructuredNote, 800);
        return;
      }
      displayed += (idx > 0 ? ' ' : '') + words[idx];
      area.innerHTML = '<span style="font-style:italic;color:var(--navy-muted)">' + displayed + '</span><span class="cursor-blink"></span>';
      idx++;
    }, 120);
  }

  function buildStructuredNote() {
    var container = document.getElementById('structuredNote');
    var sections = [
      { title: t.noteAnamnesi, value: t.noteAnamnesiVal, cls: '' },
      { title: t.noteEsame, value: t.noteEsameVal, cls: '' },
      { title: t.noteDiagnosi, value: t.noteDiagnosiVal, cls: 'diagnosis' },
      { title: t.notePiano, value: t.notePianoVal, cls: 'plan' },
      { title: t.noteNote, value: t.noteNoteVal, cls: '' }
    ];

    container.innerHTML = '';
    sections.forEach(function(sec) {
      var div = document.createElement('div');
      div.className = 'note-section' + (sec.cls ? ' ' + sec.cls : '');
      div.innerHTML = '<h4>' + sec.title + '</h4><p>' + sec.value + '</p>';
      container.appendChild(div);
    });

    container.classList.add('visible');

    /* Animate each section sequentially */
    var noteSections = container.querySelectorAll('.note-section');
    noteSections.forEach(function(ns, i) {
      setTimeout(function() {
        ns.classList.add('visible');
      }, 300 + i * 400);
    });

    /* Show CTA after notes */
    setTimeout(function() {
      document.getElementById('ctaBar').classList.add('visible');
    }, 300 + sections.length * 400 + 500);
  }

  /* ── CTA Button (sandbox-safe) ── */
  document.querySelector('.cta-btn').addEventListener('click', function(e) {
    e.preventDefault();
    var btn = this;
    btn.style.background = 'var(--accent-green)';
    btn.textContent = '\u2713 ' + (LOCALE === 'en' ? 'Thank you! We will contact you soon' : 'Grazie! Vi contatteremo presto');
    btn.style.cursor = 'default';
    btn.disabled = true;
  });

})();
</script>
</body>
</html>